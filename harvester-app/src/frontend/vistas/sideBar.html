<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Harvester App</title>
  <link href="../utils/sideBar.css" rel="stylesheet" />
  <link href="../utils/topBar.css" rel="stylesheet" />
  <link href="../utils/FrameLayout.css" rel="stylesheet" />
</head>
<body>
  <div class="formulas-brillante">
    <div class="frame-10">

      <div class="sidebar-container">
        <iframe src="sideBar.html" frameborder="0" id="sidebar-iframe"></iframe>
      </div>

      <div class="main-container">
        <div class="topbar-container">
          <div class="top-bar">
            <button class="frame-regresar">
              <img class="icono-regresar" src="../utils/iconos/FlechaAtras.svg" alt="Flecha atrás" />
              <span class="texto-boton">Regresar</span>
            </button>
            <div class="frame-titulo">
              <div class="texto-analisis">Análisis</div>
            </div>
          </div>
        </div>

        <div class="content-container">
          <div class="frame-92">
          </div>
          <div class="frame-48">
            <!-- contenido dinámico -->
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Asegúrate de que el iframe esté cargado antes de intentar acceder a su contenido
    document.getElementById('sidebar-iframe').onload = function() {
      const iframeContent = this.contentDocument || this.contentWindow.document;
      
      // Ahora puedes acceder a los elementos dentro del iframe
      const btnCollapse = iframeContent.getElementById('collapse-button');
      const btnExpand = iframeContent.getElementById('expand-button');
      const sidebarExpanded = iframeContent.getElementById('sidebar-expanded');
      const sidebarCollapsed = iframeContent.getElementById('sidebar-collapsed');

      if (btnCollapse && btnExpand && sidebarExpanded && sidebarCollapsed) {
        btnCollapse.addEventListener('click', () => {
          sidebarExpanded.style.display = 'none';
          sidebarCollapsed.style.display = 'flex';
          aplicarActivoDesdeStorage(iframeContent);
        });

        btnExpand.addEventListener('click', () => {
          sidebarCollapsed.style.display = 'none';
          sidebarExpanded.style.display = 'flex';
          aplicarActivoDesdeStorage(iframeContent);
        });
      }

      activarBotonesSidebar(iframeContent);
      aplicarActivoDesdeStorage(iframeContent);
    };

    function activarBotonesSidebar(doc) {
      const botones = doc.querySelectorAll('.boton-sidebar');

      botones.forEach(boton => {
        boton.addEventListener('click', () => {
          const seccion = boton.getAttribute('data-seccion');
          if (!seccion) return;

          const todosBotones = doc.querySelectorAll('.boton-sidebar');
          todosBotones.forEach(b => b.classList.remove('activo'));

          const coincidentes = doc.querySelectorAll(`.boton-sidebar[data-seccion="${seccion}"]`);
          coincidentes.forEach(b => b.classList.add('activo'));

          localStorage.setItem('seccion-activa', seccion);
        });
      });
    }

  // Función para aplicar clase activa desde localStorage
  function aplicarActivoDesdeStorage() {
    const seccion = localStorage.getItem('seccion-activa');
    if (!seccion) return;

    const botonesCoincidentes = document.querySelectorAll(`.boton-sidebar[data-seccion="${seccion}"]`);
    botonesCoincidentes.forEach(b => b.classList.add('activo'));
  }

  // Ejecutar al cargar
  activarBotonesSidebar();
  aplicarActivoDesdeStorage(); // aplica el estado guardado al cargar

</script>
 

</body>
</html>
